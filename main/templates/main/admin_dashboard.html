{% extends "main/base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}

<style>
/* UPDATED BACKGROUND: High Tech Dark */
body {
    background: linear-gradient(135deg, rgba(2, 6, 23, 0.95), rgba(15, 23, 42, 0.8)),
                url('https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=2070&auto=format&fit=crop') !important;
    background-size: cover !important;
    background-attachment: fixed !important;
    background-position: center !important;
    min-height: 100vh;
    color: white;
}

/* === HIGH CONTRAST DASHBOARD STYLES === */
.admin-wrapper {
    max-width: 1200px;
    margin: 20px auto;
    padding: 0 20px;
}

.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    /* Added background box for header text to ensure readability */
    background: rgba(15, 23, 42, 0.8);
    padding: 20px;
    border-radius: 16px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
}

.admin-title {
    font-size: 1.8rem;
    font-weight: 800;
    color: white;
    margin: 0;
}

.admin-subtitle {
    color: #94a3b8;
    font-size: 0.9rem;
    margin-top: 5px;
}

/* 1. High Visibility Stat Cards */
.admin-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.stat-card {
    /* Solid Dark Background for maximum contrast */
    background: #1e293b; 
    border: 1px solid #334155;
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-5px);
    border-color: #67e8f9; /* Highlight border on hover */
}

/* Accent line on top */
.stat-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #06b6d4, #3b82f6);
}

.stat-label {
    font-size: 0.85rem;
    text-transform: uppercase;
    font-weight: 600;
    letter-spacing: 1px;
    color: #94a3b8; /* Light grey label */
    margin-bottom: 10px;
}

.stat-value {
    font-size: 2.5rem; /* Large text */
    font-weight: 800;  /* Bold */
    color: #ffffff;    /* Pure White */
    line-height: 1;
}

/* 2. High Contrast Tables */
.admin-section {
    background: #1e293b; /* Dark solid background */
    border: 1px solid #334155;
    border-radius: 20px;
    padding: 0; /* Padding handled by internal elements */
    margin-bottom: 40px;
    overflow: hidden; /* Contains the table */
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
}

.section-header {
    padding: 20px 25px;
    border-bottom: 1px solid #334155;
    background: #0f172a;
}

.section-title {
    font-size: 1.2rem;
    color: white;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.table-responsive {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
    color: #e2e8f0; /* Very light grey text */
    font-size: 0.95rem;
}

thead {
    background: #334155;
    color: #67e8f9; /* Cyan headers */
}

th {
    text-align: left;
    padding: 16px 25px;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
}

td {
    padding: 16px 25px;
    border-bottom: 1px solid #334155;
}

tbody tr:hover {
    background: #334155; /* Highlight row on hover */
}

/* Status Badges for high readability */
.badge {
    padding: 5px 10px;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
}

.badge-safe { background: #064e3b; color: #34d399; border: 1px solid #059669; }
.badge-mod { background: #451a03; color: #fbbf24; border: 1px solid #d97706; }
.badge-bad { background: #450a0a; color: #f87171; border: 1px solid #dc2626; }

</style>

<div class="admin-wrapper">

    <div class="admin-header">
        <div>
            <h1 class="admin-title">Dashboard Overview</h1>
            <div class="admin-subtitle">Welcome back, Super Admin. System is running.</div>
        </div>
        <div style="background:rgba(22, 163, 74, 0.2); color:#4ade80; padding:8px 16px; border-radius:30px; font-weight:600; border:1px solid rgba(22, 163, 74, 0.4);">
            <i class="fa-solid fa-shield-halved"></i> Access Granted
        </div>
    </div>

    <div class="admin-stats">
        <div class="stat-card">
            <div class="stat-label"><i class="fa-solid fa-users"></i> Total Users</div>
            <div class="stat-value">{{ total_users }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label"><i class="fa-solid fa-flask"></i> Total Scans</div>
            <div class="stat-value">{{ total_predictions }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label"><i class="fa-solid fa-bolt"></i> Active Users</div>
            <div class="stat-value">{{ active_users }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label"><i class="fa-regular fa-clock"></i> Recent (24h)</div>
            <div class="stat-value">{{ recent_predictions }}</div>
        </div>
    </div>

    <div class="admin-section">
        <div class="section-header">
            <h3 class="section-title"><i class="fa-solid fa-user-group"></i> Registered Users</h3>
        </div>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Date Joined</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %}
                    <tr>
                        <td style="color:#94a3b8;">{{ forloop.counter }}</td>
                        <td style="font-weight:600; color:white;">
                            {{ u.username }}
                        </td>
                        <td>
                            {% if u.is_superuser %}
                                <span class="badge badge-bad">ADMIN</span>
                            {% else %}
                                <span style="color:#94a3b8;">User</span>
                            {% endif %}
                        </td>
                        <td>{{ u.date_joined|date:"d M Y, H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="admin-section">
        <div class="section-header">
            <h3 class="section-title"><i class="fa-solid fa-list-check"></i> Recent Predictions</h3>
        </div>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>User</th>
                        <th>pH Level</th>
                        <th>TDS</th>
                        <th>Result</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in predictions %}
                    <tr>
                        <td style="color:white; font-weight:600;">{{ p.user.username }}</td>
                        <td>{{ p.ph_input }}</td>
                        <td>{{ p.tds_input }}</td>
                        <td>
                            {% if p.result == 'Safe' %}
                                <span class="badge badge-safe"><i class="fa-solid fa-check"></i> Safe</span>
                            {% elif p.result == 'Moderate' %}
                                <span class="badge badge-mod">Moderate</span>
                            {% else %}
                                <span class="badge badge-bad"><i class="fa-solid fa-triangle-exclamation"></i> Unsafe</span>
                            {% endif %}
                        </td>
                        <td>{{ p.prediction_date|date:"d M Y, H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

{% endblock %}